0) í”„ë¡œì íŠ¸ ì„ íƒ: Express + SQLite + ê°„ë‹¨ ì„œë²„ë Œë”(ê¶Œì¥)
Next.jsë„ ê°€ëŠ¥í•˜ì§€ë§Œ, v1ì€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ + í¬ë¡  + DB + LLM í˜¸ì¶œì´ í•µì‹¬ì´ë¼ Expressê°€ ë¹ ë¥´ê³  ë‹¨ë‹¨í•©ë‹ˆë‹¤.
ëŸ°íƒ€ì„: Node.js (TypeScript)
ì„œë²„: Express
DB: SQLite (better-sqlite3)
í…œí”Œë¦¿: EJS (ì´ˆê°„ë‹¨ ê´€ë¦¬ì UI)
ìŠ¤ì¼€ì¤„: node-cron
LLM: Claude/OpenAI ìŠ¤ìœ„ì¹˜ ê°€ëŠ¥

1) í´ë” êµ¬ì¡° (Replit ê·¸ëŒ€ë¡œ ìƒì„±)
aiartmarket-bot/
  package.json
  tsconfig.json
  .env.example
  src/
    index.ts
    config.ts

    db/
      db.ts
      schema.sql
      migrate.ts

    jobs/
      scheduler.ts
      collect_rss.ts
      analyze_items.ts
      draft_replies.ts

    llm/
      client.ts
      prompts.ts
      types.ts

    services/
      rss.ts
      dedupe.ts
      scoring.ts
      guardrails.ts

    web/
      server.ts
      routes.ts
      views/
        layout.ejs
        login.ejs
        dashboard.ejs
        item.ejs
        drafts.ejs
        approved.ejs

    util/
      log.ts
      text.ts

2) package.json (í•„ìˆ˜ ì˜ì¡´ì„±)
{
  "name": "aiartmarket-bot",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "tsx watch src/index.ts",
    "start": "node dist/index.js",
    "build": "tsc -p tsconfig.json",
    "migrate": "tsx src/db/migrate.ts"
  },
  "dependencies": {
    "better-sqlite3": "^11.5.0",
    "cookie-parser": "^1.4.6",
    "dotenv": "^16.4.5",
    "ejs": "^3.1.10",
    "express": "^4.19.2",
    "node-cron": "^3.0.3",
    "rss-parser": "^3.13.0"
  },
  "devDependencies": {
    "@types/cookie-parser": "^1.4.7",
    "@types/ejs": "^3.1.5",
    "@types/express": "^4.17.21",
    "tsx": "^4.19.2",
    "typescript": "^5.6.3"
  }
}

3) í™˜ê²½ë³€ìˆ˜(.env.example)
PORT=3000
ADMIN_PASSWORD=change-me

DB_PATH=./data/app.db

LLM_PROVIDER=claude   # claude | openai
LLM_API_KEY=your-key

APP_BASE_URL=https://aiartmarket.io

# v1: RSS ìœ„ì£¼
RSS_FEEDS_JSON=["https://example.com/feed.xml","https://another.com/rss"]

4) DB ìŠ¤í‚¤ë§ˆ (src/db/schema.sql)
PRAGMA journal_mode=WAL;

CREATE TABLE IF NOT EXISTS sources (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  type TEXT NOT NULL, -- rss/reddit/forum/news
  url TEXT NOT NULL,
  rules_json TEXT NOT NULL DEFAULT '{}',
  enabled INTEGER NOT NULL DEFAULT 1,
  created_at TEXT NOT NULL DEFAULT (datetime('now'))
);

CREATE TABLE IF NOT EXISTS items (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  source_id INTEGER,
  external_id TEXT,
  url TEXT NOT NULL,
  title TEXT,
  author TEXT,
  created_at TEXT,
  content_text TEXT NOT NULL,
  tags_json TEXT NOT NULL DEFAULT '[]',
  status TEXT NOT NULL DEFAULT 'new', -- new/analyzed/drafted/approved/posted/skipped
  inserted_at TEXT NOT NULL DEFAULT (datetime('now')),
  UNIQUE(url),
  FOREIGN KEY(source_id) REFERENCES sources(id)
);

CREATE TABLE IF NOT EXISTS analysis (
  item_id INTEGER PRIMARY KEY,
  category TEXT NOT NULL,
  relevance_score INTEGER NOT NULL,
  reply_worthiness_score INTEGER NOT NULL,
  link_fit_score INTEGER NOT NULL,
  risk_flags_json TEXT NOT NULL DEFAULT '[]',
  recommended_action TEXT NOT NULL, -- observe/draft/skip
  suggested_angle TEXT NOT NULL DEFAULT '',
  summary_short TEXT NOT NULL,
  summary_long TEXT NOT NULL,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY(item_id) REFERENCES items(id)
);

CREATE TABLE IF NOT EXISTS drafts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  item_id INTEGER NOT NULL,
  variant TEXT NOT NULL, -- A/B/C
  draft_text TEXT NOT NULL,
  includes_link INTEGER NOT NULL DEFAULT 0,
  link_type TEXT NOT NULL DEFAULT 'none', -- none/homepage/specific
  tone TEXT NOT NULL DEFAULT 'helpful',
  admin_decision TEXT NOT NULL DEFAULT 'pending', -- pending/approved/rejected
  final_text TEXT,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY(item_id) REFERENCES items(id)
);

CREATE TABLE IF NOT EXISTS posts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  draft_id INTEGER NOT NULL,
  posted_at TEXT NOT NULL DEFAULT (datetime('now')),
  result_json TEXT NOT NULL DEFAULT '{}',
  FOREIGN KEY(draft_id) REFERENCES drafts(id)
);

5) ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ íŒŒì¼ (src/db/migrate.ts)
import fs from "node:fs";
import path from "node:path";
import Database from "better-sqlite3";
import { config } from "../config.js";

const db = new Database(config.DB_PATH);
db.pragma("journal_mode = WAL");

const schemaPath = path.resolve("src/db/schema.sql");
const schema = fs.readFileSync(schemaPath, "utf-8");
db.exec(schema);

console.log("âœ… DB migrated:", config.DB_PATH);

6) í•µì‹¬ ì„œë²„ ì—”íŠ¸ë¦¬ (src/index.ts)
import { config } from "./config.js";
import { startWeb } from "./web/server.js";
import { startScheduler } from "./jobs/scheduler.js";
import { ensureDataDir } from "./util/text.js";

ensureDataDir(config.DB_PATH);

startWeb();
startScheduler();

console.log(`âœ… Running on http://localhost:${config.PORT}`);

7) Config (src/config.ts)
import "dotenv/config";

export const config = {
  PORT: Number(process.env.PORT ?? 3000),
  ADMIN_PASSWORD: process.env.ADMIN_PASSWORD ?? "change-me",
  DB_PATH: process.env.DB_PATH ?? "./data/app.db",
  LLM_PROVIDER: (process.env.LLM_PROVIDER ?? "claude") as "claude" | "openai",
  LLM_API_KEY: process.env.LLM_API_KEY ?? "",
  APP_BASE_URL: process.env.APP_BASE_URL ?? "https://aiartmarket.io",
  RSS_FEEDS: JSON.parse(process.env.RSS_FEEDS_JSON ?? "[]") as string[],
};

8) DB ì ‘ê·¼ (src/db/db.ts)
import Database from "better-sqlite3";
import { config } from "../config.js";

export const db = new Database(config.DB_PATH);
db.pragma("journal_mode = WAL");

9) ìŠ¤ì¼€ì¤„ëŸ¬ (src/jobs/scheduler.ts)
import cron from "node-cron";
import { collectRss } from "./collect_rss.js";
import { analyzeNewItems } from "./analyze_items.js";
import { draftForAnalyzed } from "./draft_replies.js";

export function startScheduler() {
  // 10ë¶„ë§ˆë‹¤ ìˆ˜ì§‘
  cron.schedule("*/10 * * * *", async () => {
    await collectRss();
  });

  // 5ë¶„ë§ˆë‹¤ ë¶„ì„
  cron.schedule("*/5 * * * *", async () => {
    await analyzeNewItems();
  });

  // 5ë¶„ë§ˆë‹¤ ì´ˆì•ˆ ìƒì„±
  cron.schedule("*/5 * * * *", async () => {
    await draftForAnalyzed();
  });

  console.log("ğŸ•’ Scheduler started");
}

10) RSS ìˆ˜ì§‘ (src/jobs/collect_rss.ts)
import Parser from "rss-parser";
import { config } from "../config.js";
import { db } from "../db/db.js";

const parser = new Parser();

export async function collectRss() {
  for (const feedUrl of config.RSS_FEEDS) {
    try {
      const feed = await parser.parseURL(feedUrl);

      // source upsert (ë‹¨ìˆœí™”)
      const sourceName = feed.title ?? "RSS";
      const stmt = db.prepare(
        `INSERT INTO sources (name, type, url) VALUES (?, 'rss', ?)
         ON CONFLICT(url) DO UPDATE SET name=excluded.name`
      );
      // sqlite ON CONFLICT(url) í•˜ë ¤ë©´ sources.url UNIQUE í•„ìš” â†’ v1ì€ ìƒëµí•´ë„ OK
      // ëŒ€ì‹  ì—¬ê¸°ì„  ê·¸ëƒ¥ insert ignore ìŠ¤íƒ€ì¼ë¡œ ì²˜ë¦¬
      // ê°„ë‹¨íˆ: ë¨¼ì € ì¡°íšŒ í›„ ì—†ìœ¼ë©´ insert
      const existing = db.prepare("SELECT id FROM sources WHERE url=?").get(feedUrl) as any;
      let sourceId = existing?.id;
      if (!sourceId) {
        const info = db.prepare("INSERT INTO sources (name,type,url) VALUES (?,?,?)")
          .run(sourceName, "rss", feedUrl);
        sourceId = Number(info.lastInsertRowid);
      }

      for (const it of feed.items ?? []) {
        const url = it.link ?? "";
        if (!url) continue;

        const title = it.title ?? "";
        const content = (it.contentSnippet ?? it.content ?? "").toString();
        const createdAt = (it.isoDate ?? it.pubDate ?? null) as any;

        try {
          db.prepare(
            `INSERT INTO items (source_id, external_id, url, title, author, created_at, content_text)
             VALUES (?, ?, ?, ?, ?, ?, ?)`
          ).run(sourceId, it.guid ?? null, url, title, it.creator ?? null, createdAt, content || title);
        } catch {
          // ì¤‘ë³µ URLì´ë©´ ë¬´ì‹œ
        }
      }
    } catch (e) {
      console.error("RSS error:", feedUrl, e);
    }
  }
}
ë©”ëª¨: sources.url UNIQUEë¥¼ ë‘ë©´ upsertê°€ ê¹”ë”í•´ì§‘ë‹ˆë‹¤. v1ì€ ë‹¨ìˆœíˆ â€œìˆìœ¼ë©´ ê±´ë„ˆë›°ê¸°â€ë¡œë„ ì¶©ë¶„í•©ë‹ˆë‹¤.

11) LLM í´ë¼ì´ì–¸íŠ¸ (src/llm/client.ts)
ì•„ë˜ëŠ” â€œprovider ìŠ¤ìœ„ì¹˜ êµ¬ì¡°â€ë§Œ ì¡ì•„ë‘” í˜•íƒœì…ë‹ˆë‹¤.
(Claude/OpenAI ê°ê° HTTP í˜¸ì¶œë§Œ ë¶™ì´ë©´ ë©ë‹ˆë‹¤ â€” ì—¬ê¸°ì„  ì•ˆì „í•˜ê²Œ ìŠ¤ì¼ˆë ˆí†¤ë§Œ ì œê³µí•©ë‹ˆë‹¤.)
import { config } from "../config.js";

export async function callLLM(prompt: string): Promise<string> {
  if (!config.LLM_API_KEY) throw new Error("Missing LLM_API_KEY");

  // TODO: ì‹¤ì œ API í˜¸ì¶œ ì—°ê²°
  // v1 ê°œë°œ ì¤‘ì—” ì„ì‹œë¡œ ë¡œì»¬ mock(ê³ ì • JSON)ë¡œ ì‹œì‘í•´ë„ ë©ë‹ˆë‹¤.
  throw new Error("LLM call not implemented. Connect Claude/OpenAI API here.");
}
ì›í•˜ì‹œë©´ ë‹¤ìŒ í„´ì—ì„œ Claude API / OpenAI API ì‹¤ì œ í˜¸ì¶œ ì½”ë“œë¥¼ â€œë‹¹ì¥ ë™ì‘â€í•˜ê²Œ ë¶™ì—¬ë“œë¦´ê²Œìš”.
(ì—¬ê¸°ì„  í‚¤/ëª¨ë¸/ì—”ë“œí¬ì¸íŠ¸ê°€ ë°”ë€” ìˆ˜ ìˆì–´ì„œ, ì‹¤ì œ ì‚¬ìš©í•˜ì‹¤ ìª½ ê¸°ì¤€ìœ¼ë¡œ ì •í™•íˆ ì‘ì„±í•˜ëŠ” ê²Œ ì•ˆì „í•©ë‹ˆë‹¤.)

12) í”„ë¡¬í”„íŠ¸ 3ì¢… ì„¸íŠ¸ (src/llm/prompts.ts)
12-1) Analyze í”„ë¡¬í”„íŠ¸
export function buildAnalyzePrompt(input: {
  title: string;
  body: string;
  sourceName: string;
  sourceRules: string; // JSON string
}) {
  return `
ë„ˆëŠ” "AI Art ì»¤ë®¤ë‹ˆí‹° ê¸°ì—¬ì + ë¦¬ì„œì²˜"ë‹¤.
ëª©í‘œëŠ” ìŠ¤íŒ¸ í™ë³´ê°€ ì•„ë‹ˆë¼, ì§ˆë¬¸ì— ë„ì›€ì´ ë˜ëŠ” ì •ë³´ ì œê³µì´ë‹¤.
ì»¤ë®¤ë‹ˆí‹° ê·œì¹™ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•œë‹¤.

[ì…ë ¥]
- Source: ${input.sourceName}
- Rules(JSON): ${input.sourceRules}
- Title: ${input.title}
- Body:
${input.body}

[ì¶œë ¥ í˜•ì‹] ì•„ë˜ JSONë§Œ ì¶œë ¥í•´ë¼(ì„¤ëª… ê¸ˆì§€).
{
  "category": "question|rant|tool_request|business|legal|ethics|showcase|other",
  "summary_short": "í•œ ì¤„ ìš”ì•½",
  "summary_long": "3~6ì¤„ ìš”ì•½",
  "relevance_score": 0-100,
  "reply_worthiness_score": 0-100,
  "link_fit_score": 0-100,
  "risk_flags": ["promo_ban","link_ban","heated_topic","new_account_risk","unknown_rules"],
  "recommended_action": "observe|draft|skip",
  "suggested_angle": "ì–´ë–¤ ê´€ì ìœ¼ë¡œ ë‹µí•˜ë©´ ë„ì›€ì´ ë˜ëŠ”ì§€"
}

[ìŠ¤ì½”ì–´ ê°€ì´ë“œ]
- relevance_score: AI art + íŒë§¤/ë§ˆì¼“/í”„ë¡¬í”„íŠ¸/ë¼ì´ì„ ìŠ¤/ì •ì‚°/íˆ´ ë¹„êµ ê´€ë ¨ì´ë©´ ë†’ê²Œ
- reply_worthiness_score: ì§ˆë¬¸ì´ êµ¬ì²´ì ì´ê³  ë‹µë³€ì´ ë¶€ì¡±í•´ ë³´ì´ë©´ ë†’ê²Œ
- link_fit_score: 'ì–´ë””ì„œ íŒ”ê¹Œ/ë§ˆì¼“ ì¶”ì²œ'ì´ë©´ ë†’ê²Œ, ìœ¤ë¦¬ ë…¼ìŸì€ ë‚®ê²Œ
- risk_flags: ê·œì¹™ì— ë”°ë¼ ë§í¬/í™ë³´ ì œí•œì´ ìˆìœ¼ë©´ ë°˜ë“œì‹œ í‘œì‹œ
- recommended_action:
  - relevance>=60 AND reply_worthiness>=60 ì´ë©´ draft
  - riskê°€ ë„ˆë¬´ í¬ë©´ observe ë˜ëŠ” skip
`.trim();
}
12-2) Draft í”„ë¡¬í”„íŠ¸
export function buildDraftPrompt(input: {
  title: string;
  body: string;
  analysisJson: string;
  allowLink: boolean;
  baseUrl: string;
}) {
  return `
ë„ˆëŠ” AI Art ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì‹ ë¢°ë¥¼ ìƒì§€ ì•ŠëŠ” ê¸°ì—¬ìë‹¤.
ì§§ê³  ìì—°ìŠ¤ëŸ½ê²Œ, ë§¥ë½ì— ë§ê²Œ ì“´ë‹¤.
ë³µë¶™ í‹° ë‚˜ì§€ ì•Šê²Œ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ë°”ê¿”ë¼.
ê³µê²©ì /ê³¼ì¥ ê´‘ê³  ê¸ˆì§€.

[ì°¸ê³ : aiartmarket ì‚¬ì‹¤ 3ì¤„]
- aiartmarket.ioëŠ” AIë¡œ ìƒì„±ëœ ì•„íŠ¸/í”„ë¡¬í”„íŠ¸/í…œí”Œë¦¿ ë“±ì˜ ë””ì§€í„¸ ìì‚° ê±°ë˜ë¥¼ ëª©í‘œë¡œ í•œë‹¤.
- í•µì‹¬ì€ íŒë§¤/êµ¬ë§¤/ë¼ì´ì„ ìŠ¤/ì •ì‚° íë¦„ì„ ë‹¨ìˆœí•˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.
- ì—†ëŠ” ê¸°ëŠ¥ì€ ì ˆëŒ€ ë§í•˜ì§€ ì•ŠëŠ”ë‹¤.

[ì…ë ¥]
Title: ${input.title}
Body:
${input.body}

Analysis(JSON):
${input.analysisJson}

ë§í¬ í—ˆìš©: ${input.allowLink ? "YES" : "NO"}
ê¸°ë³¸ URL: ${input.baseUrl}

[ì¶œë ¥]
ì•„ë˜ JSONë§Œ ì¶œë ¥í•´ë¼.
{
  "drafts": [
    {"variant":"A","tone":"helpful","includes_link":true/false,"text":"..."},
    {"variant":"B","tone":"neutral","includes_link":true/false,"text":"..."},
    {"variant":"C","tone":"curious","includes_link":true/false,"text":"..."}
  ],
  "notes": "ì£¼ì˜í•  ì  1~2ì¤„"
}

[ë§í¬ ê·œì¹™]
- ë§í¬ í—ˆìš©ì´ NOë©´ ì ˆëŒ€ ë§í¬/ë„ë©”ì¸/ìœ ë„ ë¬¸êµ¬ë¥¼ ë„£ì§€ ë§ˆë¼.
- YESì—¬ë„ 10ë²ˆ ì¤‘ 2~3ë²ˆ ëŠë‚Œìœ¼ë¡œë§Œ, 'ì°¸ê³ ë¡œ' ìˆ˜ì¤€ìœ¼ë¡œë§Œ ì–¸ê¸‰.
`.trim();
}
12-3) Rewrite(ê´€ë¦¬ì í¸ì§‘ í›„ í†¤ ì •ë¦¬ìš©)
export function buildRewritePrompt(input: { text: string; style: string }) {
  return `
ë‹¤ìŒ ê¸€ì„ "${input.style}" ìŠ¤íƒ€ì¼ë¡œ ì§§ê³  ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ë“¬ì–´ë¼.
ê³¼ì¥/ê´‘ê³ /ëª…ë ¹í˜• í‘œí˜„ ê¸ˆì§€. í•œê¸€ ë¬¸ì¥ íë¦„ì„ ë§¤ëˆí•˜ê²Œ.
ê²°ê³¼ë§Œ ì¶œë ¥.

[ì›ë¬¸]
${input.text}
`.trim();
}

13) ë¶„ì„/ì´ˆì•ˆ ìƒì„± Job (src/jobs/analyze_items.ts, draft_replies.ts)
analyze_items.ts
import { db } from "../db/db.js";
import { callLLM } from "../llm/client.js";
import { buildAnalyzePrompt } from "../llm/prompts.js";

export async function analyzeNewItems() {
  const items = db.prepare(
    `SELECT i.*, s.name as source_name, s.rules_json as rules_json
     FROM items i
     LEFT JOIN sources s ON s.id = i.source_id
     WHERE i.status = 'new'
     ORDER BY i.inserted_at DESC
     LIMIT 10`
  ).all() as any[];

  for (const it of items) {
    const prompt = buildAnalyzePrompt({
      title: it.title ?? "",
      body: it.content_text ?? "",
      sourceName: it.source_name ?? "unknown",
      sourceRules: it.rules_json ?? "{}",
    });

    try {
      const raw = await callLLM(prompt);
      const j = JSON.parse(raw);

      db.prepare(
        `INSERT INTO analysis
         (item_id, category, relevance_score, reply_worthiness_score, link_fit_score, risk_flags_json,
          recommended_action, suggested_angle, summary_short, summary_long)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`
      ).run(
        it.id,
        j.category,
        j.relevance_score,
        j.reply_worthiness_score,
        j.link_fit_score,
        JSON.stringify(j.risk_flags ?? []),
        j.recommended_action,
        j.suggested_angle ?? "",
        j.summary_short ?? "",
        j.summary_long ?? ""
      );

      db.prepare(`UPDATE items SET status='analyzed' WHERE id=?`).run(it.id);
    } catch (e) {
      console.error("Analyze failed:", it.id, e);
      // ì‹¤íŒ¨í•´ë„ newë¡œ ë‚¨ê²¨ë‘ë©´ ë°˜ë³µë¨ â†’ ì‹¤íŒ¨ ì¹´ìš´íŠ¸ ì»¬ëŸ¼ì„ ë‘ëŠ” ê²ƒë„ ë°©ë²•
    }
  }
}
draft_replies.ts
import { db } from "../db/db.js";
import { callLLM } from "../llm/client.js";
import { buildDraftPrompt } from "../llm/prompts.js";
import { config } from "../config.js";

function shouldAllowLink(riskFlags: string[]): boolean {
  if (riskFlags.includes("promo_ban")) return false;
  if (riskFlags.includes("link_ban")) return false;
  if (riskFlags.includes("heated_topic")) return false; // v1ì—ì„  ë³´ìˆ˜ì ìœ¼ë¡œ
  return true;
}

export async function draftForAnalyzed() {
  const items = db.prepare(
    `SELECT i.*, a.category, a.risk_flags_json, a.recommended_action
     FROM items i
     JOIN analysis a ON a.item_id = i.id
     WHERE i.status = 'analyzed'
     ORDER BY i.inserted_at DESC
     LIMIT 10`
  ).all() as any[];

  for (const it of items) {
    if (it.recommended_action !== "draft") {
      db.prepare(`UPDATE items SET status='skipped' WHERE id=?`).run(it.id);
      continue;
    }

    const riskFlags = JSON.parse(it.risk_flags_json ?? "[]") as string[];
    const allowLink = shouldAllowLink(riskFlags);

    const prompt = buildDraftPrompt({
      title: it.title ?? "",
      body: it.content_text ?? "",
      analysisJson: JSON.stringify({
        category: it.category,
        risk_flags: riskFlags,
      }),
      allowLink,
      baseUrl: config.APP_BASE_URL,
    });

    try {
      const raw = await callLLM(prompt);
      const j = JSON.parse(raw);

      for (const d of j.drafts ?? []) {
        db.prepare(
          `INSERT INTO drafts (item_id, variant, draft_text, includes_link, tone)
           VALUES (?, ?, ?, ?, ?)`
        ).run(it.id, d.variant, d.text, d.includes_link ? 1 : 0, d.tone ?? "helpful");
      }

      db.prepare(`UPDATE items SET status='drafted' WHERE id=?`).run(it.id);
    } catch (e) {
      console.error("Draft failed:", it.id, e);
    }
  }
}

14) ê´€ë¦¬ì ì›¹ UI ì„¤ê³„ (í˜ì´ì§€ êµ¬ì„±)
URL ë¼ìš°íŠ¸ ì„¤ê³„
GET /login / POST /login
GET / â†’ dashboard (statusë³„ ì¹´ìš´íŠ¸ + ìµœì‹  drafted ëª©ë¡)
GET /items/:id â†’ ì›ë¬¸/ìš”ì•½/ë¦¬ìŠ¤í¬/ì´ˆì•ˆë“¤ ë³´ê¸°
POST /drafts/:draftId/approve â†’ ìŠ¹ì¸ + final_text ì €ì¥
POST /drafts/:draftId/reject
POST /items/:id/skip
ëŒ€ì‹œë³´ë“œì—ì„œ ë³´ê³  ì‹¶ì€ ê²ƒ(í•µì‹¬)
New / Analyzed / Drafted / Approved / Posted / Skipped ìˆ«ì
Drafted ëª©ë¡: ì ìˆ˜/ë¦¬ìŠ¤í¬ ë±ƒì§€
ì•„ì´í…œ ìƒì„¸ì—ì„œ:
ì´ˆì•ˆ A/B/C íƒ­
â€œë§í¬ ê°•ì œ ì œê±°â€ í† ê¸€(ìŠ¹ì¸ ì „ ìˆ˜ë™ í¸ì§‘)
â€œë³µì‚¬ ë²„íŠ¼â€ (ìµœì¢…ë³¸)

15) ì›¹ ì„œë²„ ë¼ˆëŒ€ (src/web/server.ts, routes.ts)
server.ts
import express from "express";
import cookieParser from "cookie-parser";
import path from "node:path";
import { config } from "../config.js";
import { router } from "./routes.js";

export function startWeb() {
  const app = express();

  app.use(express.urlencoded({ extended: true }));
  app.use(cookieParser());

  app.set("view engine", "ejs");
  app.set("views", path.resolve("src/web/views"));

  app.use(router);

  app.listen(config.PORT, () => console.log("ğŸŒ Web started"));
}
routes.ts (í•µì‹¬ë§Œ)
import express from "express";
import { config } from "../config.js";
import { db } from "../db/db.js";

export const router = express.Router();

function requireAuth(req: any, res: any, next: any) {
  if (req.cookies?.auth === "1") return next();
  return res.redirect("/login");
}

router.get("/login", (req, res) => res.render("login"));

router.post("/login", (req, res) => {
  const pw = req.body.password ?? "";
  if (pw === config.ADMIN_PASSWORD) {
    res.cookie("auth", "1", { httpOnly: true });
    return res.redirect("/");
  }
  return res.render("login", { error: "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤." });
});

router.get("/", requireAuth, (req, res) => {
  const counts = db.prepare(
    `SELECT status, COUNT(*) as cnt FROM items GROUP BY status`
  ).all() as any[];

  const drafted = db.prepare(
    `SELECT i.id, i.title, i.url, i.inserted_at
     FROM items i
     WHERE i.status='drafted'
     ORDER BY i.inserted_at DESC
     LIMIT 30`
  ).all() as any[];

  res.render("dashboard", { counts, drafted });
});

router.get("/items/:id", requireAuth, (req, res) => {
  const id = Number(req.params.id);

  const item = db.prepare(`SELECT * FROM items WHERE id=?`).get(id) as any;
  const analysis = db.prepare(`SELECT * FROM analysis WHERE item_id=?`).get(id) as any;
  const drafts = db.prepare(`SELECT * FROM drafts WHERE item_id=? ORDER BY variant`).all(id) as any[];

  res.render("item", { item, analysis, drafts });
});

router.post("/drafts/:draftId/approve", requireAuth, (req, res) => {
  const draftId = Number(req.params.draftId);
  const finalText = (req.body.final_text ?? "").toString().trim();

  db.prepare(`UPDATE drafts SET admin_decision='approved', final_text=? WHERE id=?`)
    .run(finalText, draftId);

  // í•´ë‹¹ item ìƒíƒœ approvedë¡œ
  const row = db.prepare(`SELECT item_id FROM drafts WHERE id=?`).get(draftId) as any;
  db.prepare(`UPDATE items SET status='approved' WHERE id=?`).run(row.item_id);

  res.redirect(`/items/${row.item_id}`);
});

router.post("/drafts/:draftId/reject", requireAuth, (req, res) => {
  const draftId = Number(req.params.draftId);
  db.prepare(`UPDATE drafts SET admin_decision='rejected' WHERE id=?`).run(draftId);
  const row = db.prepare(`SELECT item_id FROM drafts WHERE id=?`).get(draftId) as any;
  res.redirect(`/items/${row.item_id}`);
});

router.post("/items/:id/skip", requireAuth, (req, res) => {
  const id = Number(req.params.id);
  db.prepare(`UPDATE items SET status='skipped' WHERE id=?`).run(id);
  res.redirect(`/items/${id}`);
});

16) EJS UI ìµœì†Œ ë””ìì¸ ê°€ì´ë“œ (ì •ë¦¬ë§Œ)
login.ejs: ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ 1ê°œ
dashboard.ejs:
ìƒíƒœ ì¹´ìš´íŠ¸ ì¹´ë“œ
Drafted ëª©ë¡ í…Œì´ë¸”(ì œëª©/ì‹œê°„/ë§í¬)
item.ejs:
ì›ë¬¸ ë§í¬ ë²„íŠ¼
ë¶„ì„ ìš”ì•½/ë¦¬ìŠ¤í¬ ë±ƒì§€
ì´ˆì•ˆ A/B/C ê°ê° textareaë¡œ í‘œì‹œ
ìŠ¹ì¸ ë²„íŠ¼(ì„ íƒí•œ ì´ˆì•ˆì„ final_textì— ë³µì‚¬í•´ ë„£ëŠ” ì‘ì€ JS)
â€œë³µì‚¬â€ ë²„íŠ¼
UIëŠ” ì˜ˆì˜ê²Œë³´ë‹¤ ë¹ ë¥´ê²Œ ìš´ì˜ì´ ìš°ì„ ì…ë‹ˆë‹¤. ì˜ˆìœ ê±´ ë‚˜ì¤‘ì—ìš”. (ë´‡ì´ ì˜ˆì˜ë©´ ëˆì„ ë” ë²Œì§„ ì•ŠìŠµë‹ˆë‹¤â€¦ ğŸ˜„)

17) â€œë°˜ìë™ ê²Œì‹œâ€ UX (v1ì—ì„œ ë°”ë¡œ íš¨ê³¼ ë‚˜ì˜¤ëŠ” ì¥ì¹˜)
Approved ìƒíƒœì—ì„œ item ìƒì„¸ì— ì´ë ‡ê²Œ ë³´ì—¬ì£¼ì„¸ìš”:
âœ… ìµœì¢…ë³¸(final_text) í° ë°•ìŠ¤
ë²„íŠ¼:
Copy Final
Copy w/o Link (ë§í¬ ì œê±° ë²„ì „ ìë™ ìƒì„±)
Copy Short (2ì¤„ë¡œ ì••ì¶•)
ê·¸ë¦¬ê³  ì²´í¬ë¦¬ìŠ¤íŠ¸:
ì´ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë§í¬ í—ˆìš©? (risk_flags ê¸°ë°˜)
ê°™ì€ ë¬¸êµ¬ ë°˜ë³µ ìœ„í—˜? (ìµœê·¼ final_text ìœ ì‚¬ë„)

18) ë°”ë¡œ ì‹¤í–‰ ìˆœì„œ (Replitì—ì„œ)
íŒŒì¼ ìƒì„± + ì˜ì¡´ì„± ì„¤ì¹˜
.env ì‘ì„±
npm run migrate
npm run dev
ë¸Œë¼ìš°ì €ì—ì„œ /login â†’ ëŒ€ì‹œë³´ë“œ í™•ì¸
RSS_FEEDS_JSONì— ì‹¤ì œ í”¼ë“œ 2~5ê°œ ë„£ê³  ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸
LLM ì—°ê²° ì „ì—” callLLMì— ì„ì‹œ JSON ë¦¬í„´ ë„£ì–´ì„œ UI/íë¦„ ë¨¼ì € ê²€ì¦

ë‹¤ìŒìœ¼ë¡œ ì œê°€ í•´ë“œë¦´ ê²ƒ (ì„ íƒì§€ 2ê°œ ì¤‘ â€œë°”ë¡œ ë™ì‘â€ìœ¼ë¡œ)
ë‹¹ì¥ ë§‰íˆëŠ” ì§€ì ì€ LLM API ì‹¤ì œ ì—°ê²°ì´ì—ìš”.
ì›í•˜ì‹œëŠ” ë°©ì‹ìœ¼ë¡œ ë‹¤ìŒ ë‹µë³€ì—ì„œ â€œì™„ì„± ì½”ë“œâ€ ë¶™ì—¬ë“œë¦´ê²Œìš”:
Claude APIë¡œ ì—°ê²° (ì¶”ì²œ: í´ë¡œë“œë´‡ ëª©ì ì— ìì—°ìŠ¤ëŸ¬ì›€)

(ì¶”ê°€ ì§ˆë¬¸ ì—†ì´, í•´ë‹¹ ì œê³µì ê¸°ì¤€ìœ¼ë¡œ callLLM()ê¹Œì§€ ì™„ì„±í•´ì„œ ë“œë¦´ê²Œìš”.)

