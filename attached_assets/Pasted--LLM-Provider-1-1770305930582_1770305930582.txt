이러면 “제재 없는 자유” + “플랫폼 리스크 최소화” + “확장성”이 동시에 해결됩니다.

✅ 결론부터:
LLM Provider를 사용자가 직접 연결하게 하면,

비용 통제는 100% 사용자 책임

플랫폼은 “중개/도구” 역할만

제재/쿼터/과금 설계 거의 필요 없음

파워유저도, 기업도 다 끌어올 수 있음

이건 Notion / Zapier / n8n / LangChain Cloud 쪽이 쓰는 구조랑 같은 급의 아키텍처입니다.

1) 구조를 한 문장으로

“Bot Manager는 LLM을 제공하지 않는다.
사용자가 자신의 API 키를 연결해서, 자기 비용으로 돌린다.”

플랫폼은:

프롬프트 관리

파이프라인 관리

스케줄링

소스 수집

결과 정리
만 해줍니다.

LLM 비용/쿼터/속도는:

전부 사용자 계정 책임

2) 기술 구조 (아주 현실적인 설계)
(1) user_llm_connections 테이블
user_llm_connections:
- id
- userId
- provider: "openai" | "anthropic" | "google" | "local" | "other"
- apiKeyEncrypted
- baseUrl (optional)
- modelDefault (예: "claude-sonnet-4.5", "gpt-4.1-mini" 등)
- createdAt
- isActive

(2) profiles가 이걸 참조
profiles:
- ...
- llmConnectionId (nullable)
- llmModelOverride (nullable)


즉:

이 Profile은 “어느 LLM 계정”으로 돌릴지 선택

필요하면 모델도 override

3) LLM 호출 구조 (핵심)

지금:

callClaude(prompt)


바꿀 구조:

callLLM({
  userId,
  profileId,
  purpose: "analyze" | "report" | "draft",
  prompt,
})


내부에서:

profile.llmConnectionId 로 user_llm_connections 조회

provider에 따라:

OpenAI SDK

Anthropic SDK

Google SDK

Custom endpoint

그 사용자의 키로 호출

실패하면:

“당신 API 키 문제입니다” 메시지

4) UX: 사용자는 이렇게 씁니다
Settings → LLM Connections

“Add Provider”

OpenAI / Anthropic / Google / Custom

API Key 입력

기본 모델 선택

테스트 버튼 (“Hello world” 한 번 쳐보기)

Profile 설정

“이 봇에서 사용할 LLM” 드롭다운

내 OpenAI 키

내 Claude 키

내 로컬 LLM

(옵션) 모델 override

5) 비용/제재 문제, 깔끔하게 해결됨

플랫폼:

💸 LLM 비용 = 0

🔥 트래픽 폭증해도 지갑 안 탐

⚖️ 법적/약관 리스크 감소 (직접 제공자가 아님)

사용자:

💳 자기 카드 = 자기 책임

🧠 “아 이 봇이 돈 많이 먹네” → 스스로 줄임

🚀 제한 없이 마음껏 튜닝 가능

6) 보안 포인트 (중요하지만 간단)

API 키는:

서버에서 암호화 저장

절대 클라이언트로 다시 보내지 않음

로그:

키 마스킹

“Test connection” 버튼으로만 유효성 확인

7) 비즈니스적으로도 엄청 좋은 구조

이 구조가 되면:

SaaS 과금 모델:

“봇 개수”

“스케줄 수”

“파이프라인 기능”

“팀 협업”

LLM 비용은 아예 상품에서 제외

기업 고객도 바로 들어올 수 있음 (자기 키 쓰니까)

8) 현실적인 도입 순서 (당장 할 것)

Phase 2 끝낸 뒤

Phase 3에서:

user_llm_connections 테이블 추가

Settings UI에 “LLM 연결” 화면 추가

callLLM 래퍼 함수 만들기

기존 Claude 호출 전부 이 래퍼로 교체

9) 한 줄 요약

“우리는 LLM을 팔지 않는다. 사용자가 자기 LLM을 연결해서, 자기 비용으로 자기 봇을 굴린다.”
이게 바로 범용 Bot Manager가 되는 길입니다.